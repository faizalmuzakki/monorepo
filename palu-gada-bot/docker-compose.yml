services:
  palu-gada-bot:
    build: .
    container_name: palu-gada-bot
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - NODE_ENV=production
    # Option 1: Direct port exposure (for standalone use)
    # ports:
    #   - "${API_PORT:-3000}:${API_PORT:-3000}"
    # Option 2: Traefik reverse proxy (recommended for production)
    networks:
      - traefik-public
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.palu-gada-api.rule=Host(`bot-api.${DOMAIN}`)"
      - "traefik.http.routers.palu-gada-api.entrypoints=websecure"
      - "traefik.http.routers.palu-gada-api.tls.certresolver=cloudflare"
      - "traefik.http.services.palu-gada-api.loadbalancer.server.port=${API_PORT:-3000}"
    volumes:
      # Persist SQLite database
      - ./data:/app/data
      # Optional: persist logs
      - ./logs:/app/logs
    # Resource limits (adjust based on your system)
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

networks:
  traefik-public:
    external: true
